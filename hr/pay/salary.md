# 薪资计算需求更新

## 薪资周期管理
* 按自然月创建新的薪资周期（e.g. 2020年3月）
* 课时费计算周期，总月薪都绑定在一个已经创建好的薪资周期上（一对一）

## 薪资子项目独立计算，记录，结算到个人总月薪
* 薪资子项目
   
   | 序号 | 子项目 | 是否与考勤记录相关 | 说明 |
   | :--: | :--: | :--: | :--: |
   | 1 | 基本工资 | 否 | 基本月薪，可按月调整 |
   | 2 | 职级工资 | 否 | 每个职务可以有自己的职级工资 |
   | 3 | 考勤薪资调整项 | 是 | 迟到，缺勤，事假等扣除 |
   | 4 | 加班费 | 是 | 加班完成条件：加班审批通过 + 考勤正常。对于完成的加班记录，可以有2种结算方法：1. 可以按照加班时长抵扣请假，剩余时长累计到加班时长池。在每年固定日期对加班时长池进行一次性结算。2. HR勾选加班记录，结算到月薪中。 |
   | 5 | 任务工资 | 否 | |
   | 6 | 课时费 | 否 | 教师的基本工资包含免记课次对应的课时费。如果教师1个月因为自身原因没有上满免记课次的课时，课时费可以是负数。如果出现这种情况，可以让HR勾选“自身原因造成不足免记课次”。 |
   | 7 | 代课费 | 否 | |
   | 8 | 保留率奖金 | 否 | |
   | 9 | 增减项 | 否 | 1条或多条记录，调整薪资 |
   | 10 | 百分比修正 | 否 | 第 1 - 9 项，每项均可以设置百分比修正 |
   | 11 | 最低平均工资修正 | 否 | 对于第1 - 10 项的整合计算结果，可以修正（详见上海市最低平均工资比较修正) |
   
* 每个子项目有自己的记录管理（查看）页面(UI)
  * 有“结算状态”
   
     | 结算状态 |
     | :--: |
     | 未结算 |
     | 已计算（超链接到该记录涉及员工的总月薪记录）| 

  * 结算操作
    当对选中的记录进行计算后，可以选择结算到哪一个月薪。结算后，这些记录就会绑定到该月的对应的员工的总月薪的该子项目上，汇总计算后，得出该子项目的汇总值。

  * 结算撤销
    * 在薪资子项目绑定的总月薪**未**“最终结算”的情况下，可以撤销绑定（结算）这些记录
    * 状态改为“未结算”

  * 课时费计算和结算
    * 计算首先需要选择一个薪资周期
    * 计算后，得到每个教师的课时费（不含基本工资）
    * 如果一个教师出现不足免记课次，出现课时费负值，则抛出异常，HR可以勾选“自身原因不足免记课次”的选项。“是” > 保留负值，“否” > 清零。
    * HR可以勾选该薪资周期内的部分或者全部教师课时费记录，进行结算操作。因为课时费计算本身已经选择薪资周期，所以结算自动找到对应的薪资周期，绑定记录到该教师的该薪资周期的总月薪的课时费子项目中。

* 总月薪
  * 总月薪管理/查询，均需要现选择一个薪资周期 
  * 总月薪的管理/查询页面，一条记录就是一个员工的总月薪情况
  * 一个员工的一个月的总月薪记录包含上述子项目对应的记录汇总计算后的汇总值。所有子项目的汇总值相加后得出总月薪。

## 总月薪修正
* 百分比修正
  * 1个员工的1个总月薪的第 1 - 9 项，分别可以进行百分比修正
  * 百分比的范围`0%` - `100%`
  * 需要填写“备注”
* 上海市最低平均工资比较修正
  * 如果第 1 - 10 项的整合计算结果，存在低于上海市最低平均工资的记录，有一列显示“低于平均工资”标签，作为警示
  * 可以按照“低于平均工资”的标签查询记录
  * 部分或者全部选择（默认）记录，选择“调整为最低平均工资” / “不调整”

## 总月薪的最终结算
* 可以按照姓名，角色，员工类型进行按员工列出总月薪记录
* 选择部分或者全部结果，进行“最终结算”操作
* “最终结算”后，各薪资子项目的绑定“结算”就不可撤销
